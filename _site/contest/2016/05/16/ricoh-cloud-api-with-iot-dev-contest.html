<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Using RICOH Cloud API with IoT Dev Contest</title>
  <meta name="description" content="Wow, in the last few weeks, we’ve seen a huge surge incommunity activityaround development for the RICOH THETA. We have 122members in ourSilicon Valley THETA...">

  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="http://theta360.guide/blog/contest/2016/05/16/ricoh-cloud-api-with-iot-dev-contest.html">
  <link rel="alternate" type="application/rss+xml" title="THETA 360 Unofficial Blog" href="http://theta360.guide/blog/feed.xml">

</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73311422-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'contentGroup1', 'All RICOH');
</script>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <a href="/blog/"><img src="/blog/img/main/blog_banner.png"></a>
    <!-- <a class="site-title" href="/blog/">THETA 360 Unofficial Blog</a> -->

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
          
          <a class="page-link" href="/blog/official/">Official RICOH Information</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">

          <a href="http://theta360.guide">Unofficial Guides</a>
          <hr>
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Using RICOH Cloud API with IoT Dev Contest</h1>
    <p class="post-meta">
	<time datetime="2016-05-16T00:00:00+00:00" itemprop="datePublished">May 16, 2016</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Craig Oda</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Wow, in the last few weeks, we’ve seen a huge surge in
<a href="http://theta360.guide/">community activity</a>
around development for the RICOH THETA. We have 122
members in our
<a href="http://www.meetup.com/RICOH-THETA-Developers-SF-Bay-Area/">Silicon Valley THETA Dev meetup</a>
group. More than 1,000 people have visited our unofficial guide to <a href="http://theta360.guide/contest/">contest signup</a>, hoping to win some of the $45,000
in prizes, learn, and have fun.</p>

<p>People are using a variety of devices to connect to the THETA.
Many developers are
interested in storing content in the cloud and using devices
like the
<a href="http://codetricity.github.io/theta-s/index.html#_raspberry_pi">Raspberry Pi</a> to control the camera and transfer 360 media
to cloud-based servers for management. RICOH is making
<a href="http://docs.ricohapi.com/">free cloud storage</a>
available to contest participants. Here’s
how to use it with their API.</p>

<h1 id="ricoh-cloud-api-keys">RICOH Cloud API Keys</h1>

<p>First, you’ll need RICOH API Client Credentials. To help you grab
the API credentials, we created a
<a href="http://theta360.guide/contest/signup_cloudapi.html">guide</a>.</p>

<p>Once you complete the process and log into RICOH’s notes server,
you’ll get a <code class="highlighter-rouge">client_id</code> and a <code class="highlighter-rouge">client_secret</code>. The keys will be
look like this <code class="highlighter-rouge">5xm7jIvlPk4</code>, only longer. Be careful. The username
and password in get in your email is for the RICOH notes server
to download your keys. The email does not contain the actual
keys. The <code class="highlighter-rouge">client_id</code> and <code class="highlighter-rouge">client_secret</code> both look like
a string of random characters.</p>

<h1 id="unified-communications-system-user-id-and-password">Unified Communications System User ID and password</h1>

<p>In addition to the Cloud API <code class="highlighter-rouge">client_id</code> and <code class="highlighter-rouge">client_secret</code>
you will also need <code class="highlighter-rouge">user_id</code> and <code class="highlighter-rouge">password</code> from the
Unified Communications System. The <code class="highlighter-rouge">user_id</code> looks like
an email address like <code class="highlighter-rouge">user@oppkey.com</code>. The password is
a user-defined password.</p>

<p>Please refer to the
<a href="http://theta360.guide/contest/signup_cloudapi.html">Cloud API Signup guide</a>
 for more
information on what you need, where to get it, and
what each credential looks like.</p>

<h1 id="testing-ricoh-cloud-api-with-nodejs">Testing RICOH Cloud API with Node.js</h1>

<p>Use <code class="highlighter-rouge">npm</code> to install <code class="highlighter-rouge">ricohapi-mstorage</code>. I am using Ubuntu 16.04 with
node v6.1.0 installed from the
<a href="https://nodejs.org/en/download/current/">Node.js</a> site. You should be able to
use node v4.4 despite the warnings. However, I did most of my tests
with node v6.1.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install ricohapi-mstorage
</code></pre>
</div>

<p>I get minor warnings. Ignore them.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ricoh@xerus:~/Development$ npm install ricohapi-mstorage
/home/ricoh
└── ricohapi-mstorage@1.0.0

npm WARN enoent ENOENT: no such file or directory, open '/home/ricoh/package.json'
npm WARN ricoh No description
npm WARN ricoh No repository field.
npm WARN ricoh No README data
npm WARN ricoh No license field.
</code></pre>
</div>

<p>We finally get to the fun part. Open up an editor and drop in some code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const MStorage = require('ricohapi-mstorage').MStorage;
const AuthClient = require('ricohapi-mstorage').AuthClient;

const client = new AuthClient('clientId', 'clientSecret');
client.setResourceOwnerCreds('userID', 'password');

const mstorage = new MStorage(client);
</code></pre>
</div>

<p>Run the code. Hopefully, there are no error messages.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>node cloudtest2.js
</code></pre>
</div>

<p>Grab an image and save it into the same directory as your test code.
In my example, my test code is called <code class="highlighter-rouge">cloudtest2.js</code>. My test image
is a 360 equirectangular image called <code class="highlighter-rouge">beach.jpg</code>.</p>

<p>The big moment of of connecting to the RICOH Cloud server and
uploading a 360 image has arrived! Drop the code below onto the
end of your program and run it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mstorage.connect()
.then(() =&gt; mstorage.upload('./beach.jpg'))
.then(() =&gt; console.log('uploaded')
.catch(e =&gt; console.log(e)));
</code></pre>
</div>

<p>Boom. it works!</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ricoh@xerus:~/Development/ricoh-cloud-api$ node cloudtest2.js
uploaded
</code></pre>
</div>

<p>Grab a listing of your images. Add the code below to the end of your
test program.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mstorage.connect()
.then(() =&gt; mstorage.list())
.then(list =&gt; console.log(list));
</code></pre>
</div>

<p>Run it and verify the file was upload. I have multiple files in my test account. Your output may be slightly different.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ricoh@xerus:~/Development/ricoh-cloud-api$ node cloudtest2.js
{"media":[{"id":"c516ccd5-db40-438c-8f8b-e306a1c618d5"},{"id":"258f43a9-4d7a-4d4e-b625-f3a149fc7240"},{"id":"b2046fcf-1c86-47bc-a1ff-1922ecd8859a"}],"paging":{"previous":"http://mss.ricohapi.com/v1/media?before=c516ccd5-db40-438c-8f8b-e306a1c618d5\u0026limit=10"}}
uploaded
</code></pre>
</div>

<p>Grab the ID for one of your media assets in the RICOH Cloud server. Replace the ID below with your own ID.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mstorage.connect()
.then(() =&gt; mstorage.downloadTo('258f43a9-4d7a-4d4e-b625-f3a149fc7240', './img/downloadbeach.jpg' )
.then(() =&gt; console.log('downloaded')));
</code></pre>
</div>

<p>Run it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ricoh@xerus:~/Development/ricoh-cloud-api$ node cloudtest2.js
{"media":[{"id":"9d0f457e-a969-4247-81dc-3f430c2cb06d"},{"id":"c516ccd5-db40-438c-8f8b-e306a1c618d5"},{"id":"258f43a9-4d7a-4d4e-b625-f3a149fc7240"},{"id":"b2046fcf-1c86-47bc-a1ff-1922ecd8859a"}],"paging":{"previous":"http://mss.ricohapi.com/v1/media?before=9d0f457e-a969-4247-81dc-3f430c2cb06d\u0026limit=10"}}
downloaded
ricoh@xerus:~/Development/ricoh-cloud-api$ ll img/
total 4064
drwxrwxr-x 2 ricoh ricoh    4096 May 16 15:32 ./
drwxrwxr-x 4 ricoh ricoh    4096 May 16 16:34 ../
-rw-rw-r-- 1 ricoh ricoh 4151640 May 16 16:45 downloadbeach.jpg
ricoh@xerus:~/Development/ricoh-cloud-api$
</code></pre>
</div>

<h1 id="live-stream-video">Live Stream Video</h1>
<p>With your RICOH API credentials and RICOH ID, you can now live stream
inside of your browser.</p>

<p><img src="/blog/img/2016-05/ricoh-cloud-api-video-stream.png" alt="" /></p>

<h2 id="download-live-streaming-code-from-githubhttpsgithubcomricohapivideo-streaming-sample-app">Download <a href="https://github.com/ricohapi/video-streaming-sample-app">live streaming code from GitHub</a>.</h2>

<p>Follow the steps and get going.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/ricohapi/video-streaming-sample-app.git
$ cd video-streaming-sample-app
$ cp samples/config_template.js samples/config.js
</code></pre>
</div>

<p>put your credentials into the config.js</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install
$ gulp build
</code></pre>
</div>

<p>If you try running</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gulp build
</code></pre>
</div>

<p>and your system can’t find <code class="highlighter-rouge">gulp</code>, then do this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm bin
</code></pre>
</div>

<p>It will return your path, probably something like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/home/ricoh/Development/livestream/video-streaming-sample-app/node_modules/.bin
</code></pre>
</div>

<p>Build it with the path for
<a href="https://www.npmjs.com/package/gulp">gulp</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>video-streaming-sample-app$ ./node_modules/.bin/gulp build
(node:23673) fs: re-evaluating native module sources is not supported. If you are using the graceful-fs module, please update it to a more recent version.
[12:57:33] Using gulpfile ~/Development/livestream/video-streaming-sample-app/gulpfile.js
[12:57:33] Starting 'build'...
[12:57:53] Version: webpack 1.13.0
            Asset    Size  Chunks             Chunk Names
./build/bundle.js  354 kB       0  [emitted]  main
[12:57:53] Finished 'build' after 20 s
</code></pre>
</div>

<p>Run gulp</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ricoh@xerus:~/Development/livestream/video-streaming-sample-app$ ./node_modules/.bin/gulp run
(node:23840) fs: re-evaluating native module sources is not supported. If you are using the graceful-fs module, please update it to a more recent version.
[13:06:44] Using gulpfile ~/Development/livestream/video-streaming-sample-app/gulpfile.js
[13:06:44] Starting 'run'...
[13:06:44] Webserver started at http://localhost:8034
[13:06:44] Finished 'run' after 23 ms
</code></pre>
</div>

<p>It will automatically open up a browser. RICOH recommends Google Chrome 49 or
newer. I had problems logging in with Firefox on Linux.</p>

<p>Select RICOH THETA S as the device.</p>

<p><img src="/blog/img/2016-05/select-device.png" alt="" /></p>

<p>Log in with your modified RICOH username and password.</p>

<p><img src="/blog/img/2016-05/cloud-streaming-app-login.png" alt="" /></p>

<p>To set up a peer-to-peer connection, use a Ricoh user ID with a plus sign and
string after it. For example, <code class="highlighter-rouge">craig@oppkey.com+01</code> or <code class="highlighter-rouge">craig@oppkey.com+theta</code>.</p>

<p><img src="/blog/img/2016-05/streaming-p2p.png" alt="" /></p>

<p>In this example, I am using Chrome in two different tabs on the same computer.
In the screenshot at the top of this section, the THETA is connected
to one USB port of my Windows computer and another webcam (not a THETA) is
connected to another USB port on the same computer. The only reason I am only using one THETA is
because I only have one THETA at my house.</p>

<p>I am using the THETA S driver, not UVC Blender. The preview window in the
right of the browser is in dual fisheye.</p>

<p><img src="/blog/img/2016-05/livestream-preview.png" alt="" /></p>

<p>Press the <em>THETA View Mode</em> green
button to convert the incoming dual-fisheye video stream into a
equirectangular view with the JavaScript in your browser.</p>

<p><img src="/blog/img/2016-05/theta-view-mode.png" alt="" /></p>

<p>So cool!
The view has full navigation.</p>

<p><img src="/blog/img/2016-05/ricoh-cloud-api-navigation.png" alt="" /></p>

<h2 id="streaming-360-video-directly-between-two-computers">Streaming 360 Video Directly Between Two computers</h2>

<p>To stream 360 between two computers on the same network, run the samples
code on each computer. Open up a Chrome browser (Firefox didn’t work in my
tests) on each computer. The sample application will look for a webcam
on each computer. If you only have one THETA, use your standard webcam,
such as the one built into your laptop.</p>

<p>In my test network, I have the THETA connected to my Linux computer
with a USB cable. My Linux computer is connected to my home router
with WiFi on a private IP address in subnet 192.168.1.0. The router
is connected to the Internet. Remember, Firefox on Linux did not work
for me, only Chrome.</p>

<p><img src="/blog/img/2016-05/360-streaming-dual-fisheye.png" alt="" /></p>

<p>I have a second Windows 10 computer on the same subnet connected with
Ethernet.</p>

<p><img src="/blog/img/2016-05/360-streaming-image-2.png" alt="" /></p>

<p>Here’s how the network looks.</p>

<p><img src="/blog/img/2016-05/nat-demo-private-network.png" alt="" /></p>

<p>Here’s what your screen may look like.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/gnZ9IcqHruA" frameborder="0" allowfullscreen=""></iframe>

<p>Here’s a diagram of the streaming functionality of the application.
<img src="http://lists.theta360.guide/uploads/default/optimized/1X/c31047aa8a7bc5c85b1498592c96ba5fbbd23319_1_690x475.png" alt="" /></p>

<p>Here’s a diagram with some of the technology used.
<img src="http://lists.theta360.guide/uploads/default/optimized/1X/a45c78ac30c85ca8c893aae3091c862876838f87_1_690x471.png" alt="" /></p>

<h2 id="using-webrtc-between-two-computers-on-separate-networks">Using WebRTC Between Two Computers on Separate Networks</h2>

<p>To view the two 360 streams between two different computers on two
separate networks (example: San Francisco and Palo Alto), you’ll need to
assign each computer a static IP address on the Internet (not NAT on an internal network) or use NAT traversal.</p>

<p><img src="/blog/img/2016-05/stun-turn.png" alt="" /></p>

<p>I have not tried NAT Traversal yet.</p>

<p>You can check out two untested services for STUN / TURN for NAT traversal here:</p>

<ul>
  <li>Untested <a href="http://www.eyeball.com/standards/stun-turn-ice/">Eyeball</a></li>
  <li>Untested <a href="https://www.twilio.com/stun-turn/pricing">Twilio</a></li>
</ul>

<p>Article on <a href="http://www.html5rocks.com/en/tutorials/webrtc/infrastructure/">WebRTC</a></p>

<p>We have a
<a href="http://lists.theta360.guide/t/cloud-api-seminar-presentation-useful/22">full slide deck about the RICOH Cloud API</a>
as well as a space to ask
questions on our
<a href="http://lists.theta360.guide/t/theta-x-iot-developers-contest/16">THETA x IoT Developers Contest email list archive system</a>.</p>

<p>Just a few quick ideas to get your imagination going. If you build something, I’d love to hear about it.</p>

<p>Ready for more?</p>

<h1 id="in-prizes-for-the-ricoh-theta-x-iot-developers-contesthttptheta360guidecontest"><a href="http://theta360.guide/contest/">$45,000 in prizes for the RICOH THETA x IoT Developers Contest</a></h1>

  </div>

  <div id="disqus_thread"></div>
  <script>
      /**
       *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
       *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
       */

      var disqus_config = function () {
          this.page.url = /contest/2016/05/16/ricoh-cloud-api-with-iot-dev-contest.html;  // Replace PAGE_URL with your page's canonical URL variable
          this.page.identifier = /contest/2016/05/16/ricoh-cloud-api-with-iot-dev-contest; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
          var d = document, s = d.createElement('script');

          s.src = '//thetablog.disqus.com/embed.js';  // IMPORTANT: Replace EXAMPLE with your forum shortname!

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <!-- <h2 class="footer-heading">THETA 360 Unofficial Blog</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>THETA 360 Unofficial Blog</li>
          <li><a href="mailto:info@theta360.guide">info@theta360.guide</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/theta360developers"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">theta360developers</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/theta360dev"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">theta360dev</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Community information for developers of applications for the RICOH THETA camera. Go to theta360.guide for more information.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
